#########################################################
# packages

# update packages
apt-get -y update
apt-get -y remove grub-pc # unneeded, has interactive upgrade :-/
apt-get -y upgrade

# install packages for system administration
aptitude -y install \
  ruby \
  ruby1.8-dev \
  libopenssl-ruby1.8 \
  libshadow-ruby1.8 \
  libxml2-dev \
  libxslt-dev \
  rdoc \
  ri \
  irb\
  libwirble-ruby \
  build-essential \
  wget \
  curl \
  ssl-cert \
  vim \
  less \
  git-core


#########################################################
# ruby gems

RUBY_GEMS_VERSION='1.4.1'
wget http://production.cf.rubygems.org/rubygems/rubygems-${RUBY_GEMS_VERSION}.tgz
tar zxvf rubygems-${RUBY_GEMS_VERSION}.tgz

pushd rubygems-${RUBY_GEMS_VERSION}
  ruby ./setup.rb
  ln -sfv /usr/bin/gem1.8 /usr/bin/gem
popd

rm -rf rubygems-${RUBY_GEMS_VERSION}*

gem update --system

gem install --no-rdoc --no-ri bundler rake thor chef


#########################################################
# ssh

echo "github.com,207.97.227.239 ssh-rsa AAAAB3NzaC1yc2EAAAABIwAAAQEAq2A7hRGmdnm9tUDbO9IDSwBK6TbQa+PXYPCPy6rbTrTtw7PHkccKrpp0yVhp5HdEIcKr6pLlVDBfOLX9QUsyCOV0wzfjIJNlGEYsdlLJizHhbn2mUjvSAHQqZETYP81eFzLQNnPHt4EVVUh7VfDESU84KezmD5QlWpXLmvU31/yMf+Se8xhHTvKSCZIFImWwoG6mbUoWf9nzpIoaSjB+weqqUUmpaaasXVal72J+UX2B+2RPW3RcT0eOzQgqlJL3RKrTJvdsjE3JEAvGq3lGHSZXy28G3skua2SmVi/w4yCE6gbODqnTWlg7+wC604ydGXA8VJiS5ap43JXiUFFAaQ==" >> ~ubuntu/.ssh/known_hosts

cp ~ubuntu/.ssh/* ~root/.ssh

chmod -R go-rw ~/.ssh

#########################################################
# misc

echo '<%= @hostname %>' > /etc/hostname
hostname -F /etc/hostname
echo '127.0.0.1 <%= @hostname %>' >> /etc/hosts

#########################################################
# finish

sudo init 1
touch ~/.brunch_done
reboot